<?php/*- simpan pesan history max 100 pesan untuk setiap lawan bicara- bisa kirim walau lawan bicara sudah off - pesan yg belum dibaca ketika kita offline akan ditampilkan saat memulai chat - hanya mengambil data pesan yang terbaru (terkirim !=1)- setalah sukses terkirim update terkirim = 1*/include ('../../config.php');$usr1 = $_GET['usr1'];$usr2 = $_GET['usr2'];$newest = $_GET['new']; //1 -> hanya yang terbaru terkirim!=1$lastid = $_GET['lastid'];	//cek lawan bicara masih online//set terkirim= 1 sampai lastid sebelumnyaif ($lastid!='') {	$sqry = 'update chatx 			set terkirim2=1 			where (cto="'.$usr1.'" and cfrom="'.$usr2.'") and id<='.$lastid  ;						mysql_query($sqry);	$sqry = 'update chatx 			set terkirim1=1 			where ( cfrom="'.$usr1.'" and cto="'.$usr2.'")  and id<='.$lastid  ;						mysql_query($sqry);}//ambil data pesan//if ($newest==1){	$sqry = 'select * from chatx 			where 				( (cto="'.$usr1.'" and cfrom="'.$usr2.'" and terkirim1 != 1) or 				(cfrom="'.$usr1.'" and cto="'.$usr2.'" and terkirim2 != 1) )  order by tgl';	/*}else{	$sqry = 'select * from chatx 			where 				( (cto="'.$usr1.'" and cfrom="'.$usr2.'") or 				(cfrom="'.$usr1.'" and cto="'.$usr2.'") ) order by tgl';}*///echo $sqry.'<br>';				$listdata='';$qry = mysql_query($sqry);while ($row=mysql_fetch_array($qry)){	$uto = $row['cto'];	$ufr = $row['cfrom'];	$msg = $row['isi'];		$msgID = $row['Id'];	//$lastid = $row['id'];	if($uto==$usr1){		$from=$usr2;	}else{		$from=$usr1;	}	$listdata .= "		<div id='".$msgID."' style='padding:4'>			<b>$from : </b>&nbsp			$msg					</div>		";	}if ($listdata != ''){	$listdata .= "<input type='hidden' id='chat_lastid' value='".$msgID."'>";}echo $listdata;?>