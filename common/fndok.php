<?phpfunction Dok_HapusById($id){global $Main;	if ($Main->PATH_DOKUMENS!='')	{		$pathdok=$Main->PATH_DOKUMENS;		} else {		$pathdok='dokum2011';		}	$sqry = "select * from dokum where Id=$id"; //echo "<br>sqry=$sqry";	$Qry = mysql_query($sqry); 	if($isi = mysql_fetch_array($Qry)){	//echo "<br>nmfile=".$isi['nmfile'];			if ($isi['nmfile'] != ''){	unlink($pathdok.'/'.$isi['nmfile']); }		}		$Del = mysql_query("delete from dokum where id=$id limit 1");	return $Del;}function Dok_HapusByIdBI($idBI){	//idbi di dok adalah id awal	$sqry= "select * from dokum where idbi= $idBI"; //echo "<br>sqry=$sqry";	$qry = mysql_query($sqry);	while ($isi = mysql_fetch_array($qry)){		//if ($isi['nmfile'] != ''){ unlink('dokum/'.$isi['nmfile']);	}			$Del = Dok_HapusById($isi['Id']);	}	//$Del = mysql_query("delete from dokum where idbi=$idBI ");		return $Del;}function Dok_Insert( $idBI, $nmNewFile, $nmFileAsli, $fmDokKET ){		global $HTTP_COOKIE_VARS;		$uid= $HTTP_COOKIE_VARS['coID'];//echo "<br>uid=$uid"; 		$sqry = " insert into dokum (idbi, nmfile, nmfile_asli, ket, uid, tgl_update) 				value($idBI, '$nmNewFile', '$nmFileAsli','$fmDokKET','$uid', now())" ;	 						$Ins = mysql_query($sqry);	return $Ins;}function Dok_CopyByIdBI( $srcBI, $dstBI ){	$sqry = "select * from dokum where idbi =$srcBI";	$qry = mysql_query($sqry);	while ($isi = mysql_fetch_array($qry)){		Dok_Insert( $dstBI, $isi['nmfile'], $isi['nmfile_asli'], $isi['ket'] );	}	}function Dokumen_Proses($idBI){	global $Act, $errmsg, $cidBI;	global $fmDokKET, $fmDokKET2,  $nmNewFile, $nmFileAsli; 	global $Main;	if ($Main->PATH_DOKUMENS!='')	{		$pathdok=$Main->PATH_DOKUMENS;		} else {		$pathdok='dokum2011';		}			switch($Act){			case '1':{//upload				//$errmsg = uploadfile($idBI.'_','dokum');//echo "<br>errmsg=$errmsg";			uploadfile2(  50000000, 'uploadedfile', $idBI.'_', $pathdok, "Ukuran File Terlalu besar! Maksimum 50 Mb" , FALSE);			//simpan ke database 			if ( $errmsg=='' ){				if (Dok_Insert($idBI, $nmNewFile, $nmFileAsli, $fmDokKET) ==FALSE){					$errmsg = 'Data tidak dapat disimpan!';				}								if($errmsg == ''){					echo "<script>alert('Sukses upload file $nmFileAsli')</script>";				}else{					echo "<script>alert($errmsg)</script>";				}			}else{				echo "<script>alert('$errmsg')</script>";			}			break;		}		case '2':{//edit ket			$iddok = $cidBI[0];			$sqry = "update dokum set ket='$fmDokKET2' where id = $iddok";			if (mysql_query($sqry) ){				echo "<script>alert('Sukses disimpan')</script>";			}else{				echo "<script>alert('Gagal disimpan!')</script>";			}			break;		}		case '3':{//Hapus			//echo "<br>cnt=".count($cidBI);			for($i = 0; $i<count($cidBI); $i++)	{							//$bi = table_get_value("select idbi from dokum where id='{$cidBI[$i]}'", "idbi");																											//delete dokum				Dok_HapusById($cidBI[$i]);																												/*				//cek BI								$sqry = "select count(id) as cnt from dokum where idbi=$bi"; echo "<br>sqry=$sqry";				if ( table_get_value($sqry,'cnt')==0 ){					$sqry = "update buku_induk set dokumen='' , dokumen_file='', dokumen_ket='' where id=$bi"; //echo "<br>sqry=$sqry";					if( mysql_query($sqry) ==FALSE){						$errmsg = 'Tidak bisa Update Buku Induk!';					}				}*/			}									echo "<script>alert('Data telah di hapus')</script>";						}	}}function Dokumen_GetList($idbi,$cetak = FALSE){	global $Main;	global $Urutkan, $Kondisi, $LimitHal, $jmlData;	global $listTable, $tableHeader, $listHalaman, $dok_hidden;		//echo "<br>idbi=$idbi";	//echo "Tes";	//kondisi ------------------------------------				//urutan -------------------------------------	$Urutkan = "";		//limit --------------------------------------	//$LimitHal = "";			//list ----------------------------------------	$clGaris = $cetak? "GarisCetak": "GarisDaftar";	$no = 1;	$cb=0;		$listTable = "";	$sqry = "select * from dokum $Kondisi $Urutkan ";//echo "<br>sqry=$sqry $LimitHal";		$Qry = mysql_query($sqry." $LimitHal");	/*<pre style=' white-space: pre-wrap;word-wrap: break-word; width:400px;'				>".htmlentities($isi['ket'])."</pre>*/	while ($isi = mysql_fetch_array($Qry)){		$clRow = ""; if ($cetak == FALSE){$clRow = $no % 2 == 0 ?"row1":"row0"; }			$tampilCheckbox = $cetak ? "":"<td title='Pilih {$isi['nmfile_asli']}'  style='width:10' class=\"$clGaris\" align=center><input type=\"checkbox\" $Checked  id=\"cb$cb\" name=\"cidBI[]\" value=\"{$isi['Id']}\" onClick=\"isChecked(this.checked);\" style='opacity:1;' /></td>"; //<td class=\"$clGaris\" align=center><input type=\"checkbox\" $Checked  id=\"cb$cb\" name=\"cidBI[]\" value=\"{$isi['id']}\" onClick=\"isChecked(this.checked);\" /></td>		//$tampilMenu = $cetak ? "":"<div><a style='cursor:pointer'>E</a><div>";		$tampilMenu = "";		$listTable .= "			<tr class='$clRow' style='height:10' id='tr$cb'  onclick='' valign='top'>						<td class='$clGaris' style='padding:4;text-align:right;width:20;'>$no</td>						<td class='$clGaris' style='padding:4;width:20%'>								<A id='col_file' title='Download ".$isi['nmfile_asli']."' 					href ='download.php?file=".$isi['nmfile']."&dr=dokum&nm=".$isi['nmfile_asli']."'				 	style='color:#3B5998;display:block; white-space: pre-wrap;word-wrap: break-word; min-width:150;width:150px;'				>".$isi['nmfile_asli']."</a>								<!--".trim(dokumenlink2($isi['nmfile'], $isi['nmfile_asli']))." -->																			</td>			<td class='$clGaris' style='padding:4;'>								<span id='span_dok_ket' style='display:block; white-space: pre-wrap;word-wrap: break-word; min-width:350;width:350px;'				>".htmlentities($isi['ket'])."</span>							</td>						$tampilCheckbox			</tr>			";		$no ++;		$cb++;	}	$dok_hidden = "<input type=hidden name='boxchecked' value=''>";	$jmlData = table_get_value("select count(*) as cnt from dokum $Kondisi ",'cnt');	if (empty($jmlData)){		$jmlData=0;	}	//$listHalaman = "<tr><td colspan=4 align=center>".Halaman($jmlData,$Main->PagePerHal,"HalDefault")."</td></tr>";		//header -------------------------------------	$clr = '#CCCCCC';	$tampilCheckbox =  $cetak ? "" : 		"<th class='th01' style='width:10;padding:2;background:$clr;color:black;'><input title='Pilih Semua' type='checkbox' name='toggle' value='' onClick='checkAll($jmlData)' </th>";				$tableHeader = "		<a name='FormEntryDok' style='position:relative;top:-100;'></a>		<tr>		<th class='th01' style='width:20; padding:2;background:$clr;color:black;' >No</th>				<th class='th01' style='width:20%; padding:2;background:$clr;color:black;'>Dokumen</th>		<th class='th01' style='padding:2;background:$clr;color:black;'>Keterangan</th>			$tampilCheckbox		</tr>";		}function Dok_Page($idbi, $embed=0, $FormName='FormEntryDok', $cetak = FALSE){	global $dok_page;	global $Main;	//list	global  $Urutkan, $Kondisi, $LimitHal, $jmlData;	global $listTable, $tableHeader, $listHalaman, $dok_hidden;	//proses	global $Act, $errmsg, $cidBI;	global $fmDokKET, $fmDokKET2, $idBI, $nmNewFile, $nmFileAsli; 		global $dok_scriptUpload, $dok_tampilMenu, $dok_tampilList;//, $dok_hidden;//echo "<br>idbi=$idbi";//echo "<br>embed=$embed";//const --------------------------------------$imgLoadSrc = "images/administrator/images/loading.gif";$timeOut = 5000;$idImgLoad = 'imgload';//get param ----------------------------------$fmDokKET = $_POST['fmDokKET'];//echo "<br>fmKET=$fmKET";$fmDokKET2 = $_POST['fmDokKET2'];//echo "<br>fmKET=$fmKET2";$cidBI = $_POST['cidBI'];$viewInfoBrgNo = $_GET['viewInfoBrgNo'];$viewHeadTblNo = $_GET['viewHeadTblNo'];//$embed = $_GET['embed']; //if ($embed==1){	$viewInfoBrgNo = 1;	}//proses  ------------------------------Dokumen_Proses($idbi);		//Form Entry upload -------------------------------$FormUpload = "		<input type='hidden' name='nmFile'  value='$nmFile'>		<table class ='' style=''>			<tr>			<td ><b>Dokumen</b></td>					<td ><input type='file' id='selFile' name='uploadedfile'  value='Ganti' onchange='' onclick='' style='opacity:0.9' size='56' />	</td>		</tr>		<tr valign='top'>			<td > <b>Keterangan</b>	</td>					<td ><textarea name='fmDokKET' cols='64' style='overflow-y:scroll;overflow:-moz-scrollbars-vertical;height:50'></textarea></td>					</tr>				<tr>			<td colspan='2' align='right'> 							<div style='float:right'>				<input type='button' id='btsimpan' name='btsimpan'  value='Simpan' onclick='uploadFile()'  /> 				<input type='button' id='btbatal' name='btbatal'  value='Batal' onclick='closeEntry()'  /> 				</div>				<div style='float:right;padding:5 5 0 0'>					<img src='$imgLoadSrc' id=$idImgLoad style='visibility:hidden;display: block; vertical-align: middle; margin-left: auto;  margin-right: auto'> 				</div>			</td>					</tr>	</table>		";$EntryKet = "	<table>			<tr valign='top'><td id='EntryKet_File' colspan=2></td></tr>			<tr valign='top'>			<td><b>Keterangan</b></td>			<td><textarea id='fmDokKET2' name='fmDokKET2' cols='64' style='overflow-y:scroll;overflow:-moz-scrollbars-vertical;height:50'></textarea></td>		</tr>		<tr ><td colspan=2>			<div style='float:right'>			<input type='button' id='btSimpanKet' name='btSimpanKet'  value='Simpan' onclick='simpanEntryKet()'  /> 			<input type='button' id='btBatalKet' name='btBatalKet'  value='Batal' onclick='closeEntryKet()'  /> 			</div>					</td></tr>	</table>	";//dokumen list --------------------------------------/*$Hal = cekPOST("Hal",1);$LimitHal = " limit ".(($Hal*1) - 1) * $Main->PagePerHal.",".$Main->PagePerHal;*/$Kondisi = " where idbi = $idbi";Dokumen_GetList($idbi);if ($viewHeadTblNo){ 	$tableHeader = ""; }else{ 	/*	$tableHeader = "		<table id='tblHeadDok' border='1' class='koptable' style='border-width:0; width :100%' >		$tableHeader 		</table>	";*/}$tablewidth = $embed==1? '583px':'100%';$dok_tampilList= "	<table id='tblListDok' border='1' class='koptable2' style='border-width:0; width :$tablewidth' >		$tableHeader 		$listTable		$listHalaman	</table>	";	$menuwidth = $embed==1? '573px':'';$dok_tampilMenu = 	"<!--<div id='menuku' style='height:18;padding:0;background-color: black; 	    border-color: black; border-style: solid; border-width: 2px;'>-->	<div id='menuh' style='width:$menuwidth'>	<ul>	<li><a class='dok_btdel' title='Hapus Dokumen' onclick='prosesHapus()'></a></li>	<li><a class='dok_btedit' title='Edit Dokumen' onclick='showEntryKet()'></a>		<ul id='ulEntryKet' >			<li style='width:470;top:-4;z-index:99;'>				<!--".setBackTransparan( setCenterPage(setShadowForm2( FormContainer($EntryKet))), "onclick='closeEntryKet()'" )."-->				". FormContainer($EntryKet)."			</li>		</ul>	</li>	<li ><a class='dok_btadd' title='Tambah Dokumen' onclick='showEntry()'></a>		<ul id='ulFormEntry'>			<li style='width:470;top:-4;z-index:99;'>											<!--". setBackTransparan( setCenterPage(setShadowForm2( FormContainer($FormUpload) )), "onclick='closeEntry()'" )."	-->				". FormContainer($FormUpload) ."			</li>		</ul>	</li>	</ul>	<a title='Jumlah Dokumen' style='cursor:default;position:relative;left:2;top:2;color:gray;font-size:11;'>[ $jmlData ]</a>	</div>	";//javascript -----------------------------------if(empty($viewHeadTblNo)){	$scriptGetCel = "var cel = document.getElementById('tblListDok').rows[i+1].cells;";	}else{	$scriptGetCel = "var cel = document.getElementById('tblListDok').rows[i].cells;";}	$dok_scriptUpload = "	<script type='text/javascript'>						function uploadFile(){	//alert(document.getElementById('selFile').value);								var str = document.getElementById('selFile').value;			var errmsg = '';			if (errmsg=='' && str == ''){	errmsg = 'File belum dipilih!';	}			if (errmsg=='' && str.indexOf(' ')>=0 ){	errmsg = 'Nama File tanpa spasi!';	}			//if (str != '' && str.indexOf('')==-1){							if(errmsg ==''){				document.getElementById('".$idImgLoad."').style.visibility= 'visible';				adminForm.enctype='multipart/form-data';				adminForm.action='#{$FormName}'	;				document.adminForm.Act.value=1;				addCoverPage('coverpage',100);				document.adminForm.submit();				adminForm.action=''	;			}else{				alert(errmsg);			}		}		function showEntry(){//alert('tes');			document.body.style.overflow='hidden';			addCoverPage('FmEntryDok_cover',1);			document.getElementById('ulFormEntry').style.visibility='visible';		}		function closeEntry(){				delElem('FmEntryDok_cover');					document.body.style.overflow='auto';			document.getElementById('ulFormEntry').style.visibility='hidden';		}		function simpanEntryKet(){					adminForm.action='#{$FormName}'	;				document.adminForm.Act.value=2;			addCoverPage('coverpage',100);			document.adminForm.submit();			adminForm.action=''	;		}		function showEntryKet(){			//alert(adminForm.boxchecked.value);			var errmsg = '';			if((errmsg=='') && (adminForm.boxchecked.value >1 )){errmsg= 'Pilih Hanya Satu Data!';}			if((errmsg=='') && (adminForm.boxchecked.value == 0 )){	errmsg= 'Data belum dipilih!';}			if(errmsg ==''){								for(var i=0; i < ".$jmlData."; i++){					var str = 'document.adminForm.cb' + i; 										if (eval(str)){						box = eval( str );	//alert( i+' '+ box.value);											if( box.checked){														document.body.style.overflow='hidden';							addCoverPage('FmEntryDok_cover',1);							var id = box.value;								$scriptGetCel							document.getElementById('EntryKet_File').innerHTML =  cel[1].getElementsByTagName('a')[0].innerHTML;//alert(cel[2].innerHTML);							var ket = cel[2].getElementsByTagName('span')[0].innerHTML;							//var ket = cel[2].innerHTML;							document.getElementById('fmDokKET2').value = Encoder.htmlDecode(ket);							document.getElementById('ulEntryKet').style.visibility='visible';						}					}				}			}else{				alert(errmsg);			}					}		function closeEntryKet(){						delElem('FmEntryDok_cover');			document.body.style.overflow='auto';			document.getElementById('ulEntryKet').style.visibility='hidden';		}		function prosesHapus(){						if (adminForm.boxchecked.value >0 ){				if(confirm('Yakin '+adminForm.boxchecked.value+' data akan di hapus?')){										adminForm.action='#{$FormName}'	;					adminForm.Act.value=3;										adminForm.submit();					adminForm.action=''	;				}			}		}	</script>";//--------------- info barang -------------------------------if (empty($viewInfoBrgNo)){	$sqry = "select * from view_buku_induk2 where id = $idbi";// echo $sqry;	$qry = mysql_query($sqry);	$isi = mysql_fetch_array($qry);	$idbigbr = $isi['idawal'] == ''?$isi['id']:$isi['idawal'];//echo "idbigbr=$idbigbr<br>";	$fgbr = table_get_value("select nmfile from gambar where stat=1 and idbi=$idbigbr",'nmfile'); //echo "fgbr=$fgbr<br>";	//$sImg = $fgbr == ''? '': '<img src ="view_img.php?fname='.$fgbr.'&sw=200&sh=150" width="200" height="150" >';	$infoBrg = "		<table>		<tr>			<td height='60' width='100' align=center style='	background-color:#EFEFF1; background-image: url(http:images/administrator/images/blank.jpg); background-repeat-x: no-repeat;	background-repeat-y: no-repeat;	border: 2px solid #EFEFF1'>					<!--<img src='view_img.php?fname={$isi['gambar']}&sw=80&sh=60' alt='' >-->				<img src='view_img.php?fname=$fgbr&sw=80&sh=60' alt='' >			</td>			<td>				<span><b>{$isi['a1']}.{$isi['a']}.{$isi['b']}.{$isi['c']}.{$isi['d']}.{$isi['e']}  {$isi['f']}.{$isi['g']}.{$isi['h']}.{$isi['i']}.{$isi['j']} {$isi['thn_perolehan']}.{$isi['noreg']} </b></span><br>				{$isi['nmbidang']} - {$isi['nmopd']} - {$isi['nmunit']}<br>				{$isi['nm_barang']}<br>				Tahun Perolehan {$isi['thn_perolehan']}<br>				Rp. ".number_format($isi['jml_harga'],2,',','.')."			</td>			</tr>		</table>		";}//page ----------------------------------------------if (empty($viewInfoBrgNo)){ $topList= '97';}else{$topList= '26'; }$dok_page= " 	$dok_scriptUpload 	<!--<form action='' method='post' name='adminForm' id='adminForm' enctype='multipart/form-data'> 	-->	<div id='{$FormName}_head' style='min-width:400;position:fixed; top:0; width:100%;z-index:100;background:white'>	$infoBrg	$dok_tampilMenu				<!--$tableHeader-->	</div>		<div id='{$FormName}_body' style='position:relative;top:$topList'>		$dok_tampilList		</div>		$dok_hidden	<input type='hidden' name='Act' id='Act' value =''>	<!--</form>-->	";return $dok_page;}?>