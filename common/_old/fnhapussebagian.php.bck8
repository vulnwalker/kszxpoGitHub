<?phpfunction HapusSebagian_ProsesSimpan(){	global $HTTP_COOKIE_VARS, $Main; 	$sukses = FALSE;			$MyModulKU = explode(".",$HTTP_COOKIE_VARS["coModul"]);					 	if ($MyModulKU[6]=='1'){			$arrParams = array('fmTANGGALPENGHAPUSAN');				//$fmNOREG = $_GET['fmNOREG']; 		$$arrParams[0] = $_GET[$arrParams[0]]; //		$fmJENISPEMELIHARAAN = $_GET['fmJENISPEMELIHARAAN'];//		$fmPEMELIHARAINSTANSI = $_GET['fmPEMELIHARAINSTANSI'];//		$fmPEMELIHARAALAMAT = $_GET['fmPEMELIHARAALAMAT'];		$fmURAIAN = $_GET['fmURAIAN'];		$fmSURATNOMOR = $_GET['fmSURATNOMOR'];		$fmSURATTANGGAL = $_GET['fmSURATTANGGAL'];		$fmHARGA_AWAL = $_GET['fmHARGA_AWAL'];		$fmHARGA_HAPUS = $_GET['fmHARGA_HAPUS'];		$fmHARGA_SCRAP = $_GET['fmHARGA_SCRAP'];//		$fmBUKTIPEMELIHARAAN = $_GET['fmBUKTIPEMELIHARAAN'];		$fmKET = $_GET['fmKET'];//		$fmTAMBAHASET = $_GET['fmTAMBAHASET'];				$UID = $HTTP_COOKIE_VARS['coID'];				$idbi = $_GET['idbi'];		$idplh = $_GET['idplh'];		$fmst = $_GET['fmst'];		$fmTANGGALPEROLEHAN = $_GET['fmTANGGALPEROLEHAN'];		$idbi_awal = $_GET['idbi_awal'];				if ($fmst==0){			if ($idplh!='')			{												$hsbg =  mysql_fetch_array( mysql_query (								" select idbi_awal  from penghapusan_sebagian where id ='$idplh'"			));			$idbi=$hsbg['idbi_awal'];			}					}				if ($fmHARGA_HAPUS == ''){$fmHARGA_HAPUS = 0;}			if ($fmHARGA_AWAL == ''){$fmHARGA_AWAL = 0;}	/*		if (!empty($fmTAMBAHASET)){			$fmTAMBAHASET = 1;		}else{			$fmTAMBAHASET=0;		}*/				$errmsg ='';//",fmTAMBAHASET=$fmTAMBAHASET";		/*$errmsg = " fmTANGGALPEMELIHARAAN=$fmTANGGALPENGHAPUSAN, fmJENISPEMELIHARAAN=$fmJENISPEMELIHARAAN,		fmPEMELIHARAINSTANSI=$fmPEMELIHARAINSTANSI, fmPEMELIHARAALAMAT=$fmPEMELIHARAALAMAT, fmSURATNOMOR=$fmSURATNOMOR,		fmSURATTANGGAL=$fmSURATTANGGAL, fmBIAYA=$fmHARGA_HAPUS, fmBUKTIPEMELIHARAAN=$fmBUKTIPEMELIHARAAN, fmKET=$fmKET,		idbi=$idbi, idplh=$idplh, idbi_awal=$idbi_awal, ActEntry=$ActEntry, fmst=$fmst";*/		//validasi -----------------------		if($fmHARGA_AWAL == '' || $fmHARGA_AWAL==0 ){ $errmsg = 'Nilai aset belum diisi!';	}					if($fmHARGA_HAPUS == '' || $fmHARGA_HAPUS==0 ){ $errmsg = 'Nilai Penghapusan belum diisi!';	}					if($fmHARGA_HAPUS > $fmHARGA_AWAL){ $errmsg = 'Nilai Penghapusan harus lebih kecil dari nilai aset!';	}					if($fmTANGGALPEROLEHAN == '0000-00-00' || $fmTANGGALPEROLEHAN=='' ){ $errmsg = 'Tanggal Perolehan belum diisi!';	}				if($fmTANGGALPENGHAPUSAN == '0000-00-00' || $fmTANGGALPENGHAPUSAN=='' ){ $errmsg = 'Tanggal Penghapusan belum diisi!';	}				if($errmsg=='' && !cektanggal($fmTANGGALPENGHAPUSAN)){	$errmsg = "Tanggal Penghapusan $fmTANGGALPENGHAPUSAN Salah!";	}			if ($errmsg =='' && compareTanggal($fmTANGGALPENGHAPUSAN, date('Y-m-d'))==2  ) $errmsg = 'Tanggal Penghapusan tidak lebih besar dari Hari ini!';						if ($errmsg =='' && compareTanggal($fmTANGGALPEROLEHAN,$fmTANGGALPENGHAPUSAN )==2) $errmsg = 'Tanggal Perolehan tidak lebih besar dari Tanggal Penghapusan !';						$thn_PEROLEHAN= substr($fmTANGGALPEROLEHAN,0,4);						if ($errmsg ==''){			$bi =  mysql_fetch_array( mysql_query (								" select tgl_buku,thn_perolehan from buku_induk where id ='$idbi'"			));			if ($errmsg =='' && compareTanggal($fmTANGGALPENGHAPUSAN, $bi['tgl_buku'])==0  ) $errmsg = 'Tanggal Penghapusan tidak lebih kecil dari Tanggal Buku!';					}					if( $errmsg =='' & (!($fmSURATTANGGAL == '0000-00-00' || $fmSURATTANGGAL==''))){		 	if( !cektanggal($fmSURATTANGGAL)){ 	$errmsg = 'Tanggal Surat Salah!';}			if ($errmsg =='' && compareTanggal($fmSURATTANGGAL, date('Y-m-d'))==2  ) $errmsg = 'Tanggal Surat tidak lebih besar dari Hari ini!';						}		if ($errmsg=='' && $fmst==1){		 $errmsg=HapusSebagian_CekdataCutoff('insert',$idplh,$fmTANGGALPENGHAPUSAN,$idbi);			 }		 		$get_cd = mysql_fetch_array(mysql_query("select c,d,e,e1,tgl_buku,thn_perolehan from buku_induk where id='$idbi'"));		$tgl_closing=getTglClosing($get_cd['c'],$get_cd['d'],$get_cd['e'],$get_cd['e1']); 		//get tglakhir susut,koreksi,penilaian,penghapusan_sebagian dgn idbi_awal yg sama		$tgl_susutAkhir = mysql_fetch_array(mysql_query("select tgl from penyusutan where idbi_awal='$idbi' order by tgl desc limit 1"));		$tgl_korAkhir = mysql_fetch_array(mysql_query("select tgl,tgl_create from t_koreksi where idbi_awal='$idbi' order by tgl desc limit 1"));		$tgl_nilaiAkhir = mysql_fetch_array(mysql_query("select tgl_penilaian,tgl_create from penilaian where idbi_awal='$idbi' order by tgl_penilaian desc limit 1"));		$tgl_hpsAkhir = mysql_fetch_array(mysql_query("select tgl_penghapusan,tgl_create from penghapusan_sebagian where idbi_awal='$idbi' order by tgl_penghapusan desc limit 1"));		//-------------------------------------		if ($fmst==1 && $errmsg ==''){			//jika tambah aset =1 atau tambah manfaat = 1:			//if($fmTAMBAHASET==1 || $fmTAMBAHMasaManfaat==1){				if($errmsg =='' && compareTanggal($bi['tgl_buku'],$fmTANGGALPENGHAPUSAN)==2) $errmsg = 'Tanggal Penghapusan tidak kecil dari Tanggal Buku Barang !';								if($errmsg =='' && $thn_PEROLEHAN<$bi['thn_perolehan']) $errmsg = 'Tahun Perolehan tidak kecil dari Tahun Perolehan Buku Barang !';								if($errmsg=='' && $fmTANGGALPENGHAPUSAN<=$tgl_closing)$errmsg ='Tanggal sudah Closing !';				if($errmsg=='' && $fmTANGGALPENGHAPUSAN<=$tgl_susutAkhir['tgl'])$errmsg ='Sudah ada penyusutan !';				if($errmsg=='' && $fmTANGGALPENGHAPUSAN<$tgl_korAkhir['tgl'] )$errmsg ='Sudah ada koreksi harga !';				if($errmsg=='' && $fmTANGGALPENGHAPUSAN<$tgl_nilaiAkhir['tgl_penilaian'] )$errmsg ='Sudah ada penilaian !';				if($errmsg=='' && $fmTANGGALPENGHAPUSAN<$tgl_hpsAkhir['tgl_penghapusan'] )$errmsg ='Sudah ada penghapusan sebagian !';			//}		//if($errmsg=='' && $old_penghapusan['tgl_penghapusan']<$tgl_susutAkhir['tgl']){					}else{					$old_penghapusan = mysql_fetch_array(mysql_query("select * from penghapusan_sebagian where id='$idplh'"));			//$errmsg='tgl_='.$old_penghapusan['tgl_penghapusan'];			//cek tgl buku lama <= tgl closing			if($errmsg=='' && $old_penghapusan['tgl_penghapusan']<=$tgl_closing){				if($errmsg=='' && $old_penghapusan['tgl_penghapusan']!=$fmTANGGALPENGHAPUSAN)$errmsg = 'Tanggal Penghapusan tidak bisa di edit,karena sudah closing !';				if($errmsg=='' && $old_penghapusan['tgl_perolehan']!=$fmTANGGALPerolehan)$errmsg = 'Tanggal Perolehan tidak bisa di edit,karena sudah closing !';				if($errmsg=='' && $old_penghapusan['harga_hapus']!=$fmHARGA_HAPUS)$errmsg = 'Nilai Penghapusan tidak bisa di edit,karena sudah closing !';				}						//cek tgl perolehan lama < tgl susut akhir 			if($errmsg=='' && ($old_penghapusan['tgl_perolehan']<=$tgl_susutAkhir['tgl'] && $old_penghapusan['tgl_penghapusan']<=$tgl_susutAkhir['tgl'])){				if($errmsg=='' && $old_penghapusan['tgl_penghapusan']!=$fmTANGGALPENGHAPUSAN)$errmsg = 'Tanggal Penghapusan tidak bisa di edit,sudah ada penyusutan !';				if($errmsg=='' && $old_penghapusan['tgl_perolehan']!=$fmTANGGALPerolehan)$errmsg = 'Tanggal Perolehan tidak bisa di edit,sudah ada penyusutan !';				if($errmsg=='' && $old_penghapusan['harga_hapus']!=$fmHARGA_HAPUS)$errmsg = 'Nilai Penghapusan tidak bisa di edit,sudah ada penyusutan !';				}			//cek (tgl buku lama < tgl buku koreksi terakhir) atau (tgl buku lama = tgl buku koreksi terakhir  dan waktu create < waktu create koreksi terakhir)			if(($errmsg=='' && $old_penghapusan['tgl_penghapusan']<$tgl_korAkhir['tgl']) || ($old_penghapusan['tgl_penghapusan']==$tgl_korAkhir['tgl'] && $old_penghapusan['tgl_create']<$tgl_korAkhir['tgl_create'])){				if($errmsg=='' && $old_penghapusan['tgl_penghapusan']!=$fmTANGGALPENGHAPUSAN)$errmsg = 'Tanggal Penghapusan tidak bisa di edit,sudah ada koreksi harga !';				if($errmsg=='' && $old_penghapusan['tgl_perolehan']!=$fmTANGGALPerolehan)$errmsg = 'Tanggal Perolehan tidak bisa di edit,sudah ada koreksi harga !';				if($errmsg=='' && $old_penghapusan['harga_hapus']!=$fmHARGA_HAPUS)$errmsg = 'Nilai Penghapusan tidak bisa di edit,sudah ada koreksi harga !';				}			//cek (tgl buku lama < tgl buku penilaian terakhir) atau (tgl buku lama = tgl buku penilaian terakhir  dan waktu create < waktu create penilaian terakhir)			if(($errmsg=='' && $old_penghapusan['tgl_penghapusan']<$tgl_nilaiAkhir['tgl_penilaian']) || ($old_penghapusan['tgl_penghapusan']==$tgl_nilaiAkhir['tgl_penilaian'] && $old_penghapusan['tgl_create']<$tgl_nilaiAkhir['tgl_create'])){				if($errmsg=='' && $old_penghapusan['tgl_penghapusan']!=$fmTANGGALPENGHAPUSAN)$errmsg = 'Tanggal Penghapusan tidak bisa di edit,sudah ada penilaian !';				if($errmsg=='' && $old_penghapusan['tgl_perolehan']!=$fmTANGGALPerolehan)$errmsg = 'Tanggal Perolehan tidak bisa di edit,sudah ada penilaian !';				if($errmsg=='' && $old_penghapusan['harga_hapus']!=$fmHARGA_HAPUS)$errmsg = 'Nilai Penghapusan tidak bisa di edit,sudah ada penilaian !';				}			//cek (tgl buku lama < tgl buku hapus sebagian terakhir) atau (tgl buku lama = tgl buku hapus sebagian terakhir  dan waktu create < waktu create hapus sebagian terakhir)			if(($errmsg=='' && $old_penghapusan['tgl_penghapusan']<$tgl_hpsAkhir['tgl_penghapusan']) || ($old_penghapusan['tgl_penghapusan']==$tgl_hpsAkhir['tgl_penghapusan'] && $old_penghapusan['tgl_create']<$tgl_hpsAkhir['tgl_create'])){				if($errmsg=='' && $old_penghapusan['tgl_penghapusan']!=$fmTANGGALPENGHAPUSAN)$errmsg = 'Tanggal Penghapusan tidak bisa di edit,sudah ada penghapusan sebagian !';				if($errmsg=='' && $old_penghapusan['tgl_perolehan']!=$fmTANGGALPerolehan)$errmsg = 'Tanggal Perolehan tidak bisa di edit,sudah ada penghapusan sebagian !';				if($errmsg=='' && $old_penghapusan['harga_hapus']!=$fmHARGA_HAPUS)$errmsg = 'Nilai Penghapusan tidak bisa di edit,sudah ada penghapusan sebagian !';				}								}						if($errmsg == ''){				if ($fmst==1){//simpan baru				$isibi= table_get_rec("select * from view_buku_induk2 where id = '$idbi'" );				$idbi_awal = $isibi['idawal'] ==''? $isibi['id']: $isibi['idawal'];				/*$aqry = "insert into pemeliharaan (id_bukuinduk, 					a1,a,b,c,d,e,f,g,h,i,j,thn_perolehan, noreg,					tgl_pemeliharaan, jenis_pemeliharaan, pemelihara_instansi, pemelihara_alamat,					surat_no, surat_tgl, biaya_pemeliharaan,  ket, idbi_awal, tgl_update, uid  ) 					values ('$idbi',						'{$isibi['a1']}', '{$isibi['a']}', '{$isibi['b']}', 						'{$isibi['c']}', '{$isibi['d']}', '{$isibi['e']}', 						'{$isibi['f']}', '{$isibi['g']}', '{$isibi['h']}', '{$isibi['i']}', '{$isibi['j']}',						{$isibi['thn_perolehan']}, '{$isibi['noreg']}',						'$fmTANGGALPENGHAPUSAN', '$fmJENISPEMELIHARAAN', '$fmPEMELIHARAINSTANSI', '$fmPEMELIHARAALAMAT', 						'$fmSURATNOMOR', '$fmSURATTANGGAL', '$fmHARGA_HAPUS',  '$fmKET',						'$idbi_awal', now(), '$UID'									) ";//echo "aqry=$aqry<r>";*/				$aqry = "insert into penghapusan_sebagian (id_bukuinduk, 									tgl_penghapusan,uraian, 					surat_no, surat_tgl, harga_awal,harga_hapus,harga_scrap,  ket, idbi_awal, tgl_update, uid, tgl_perolehan  ) 					values ('$idbi',											'$fmTANGGALPENGHAPUSAN','$fmURAIAN',    						'$fmSURATNOMOR', '$fmSURATTANGGAL', '$fmHARGA_AWAL', '$fmHARGA_HAPUS', '$fmHARGA_SCRAP',  '$fmKET',						'$idbi_awal', now(), '$UID','$fmTANGGALPEROLEHAN'									) ";//echo "aqry=$aqry<r>";				$sukses = mysql_query($aqry);				if($sukses  ){					$id = mysql_insert_id();					if($Main->MODUL_JURNAL) jurnalHapusSebagian($id,$UID,1);				}							}else{//smpan edit					if ($errmsg=='') $errmsg=HapusSebagian_CekdataCutoff('edit',$idplh,$fmTANGGALPENGHAPUSAN,$idbi_awal);									if($errmsg ==''){					$aqry = "update penghapusan_sebagian set						tgl_penghapusan = '$fmTANGGALPENGHAPUSAN', 						tgl_perolehan = '$fmTANGGALPEROLEHAN', 						uraian = '$fmURAIAN', 												surat_no = '$fmSURATNOMOR', 						surat_tgl = '$fmSURATTANGGAL', 						harga_awal = '$fmHARGA_AWAL', 												harga_hapus = '$fmHARGA_HAPUS', 												harga_scrap = '$fmHARGA_SCRAP', 												ket = '$fmKET',						tgl_update = now(),						uid = '$UID'						where id = '$idplh'";//echo "aqry=$aqry<r>";					$sukses = mysql_query($aqry);					if($sukses) {						if($Main->MODUL_JURNAL)jurnalHapusSebagian($idplh,$UID, 2);						//if($old['tambah_aset']==$fmTAMBAHASET && $fmTAMBAHASET ==1) jurnalHapusSebagian($idplh,$UID, 2);						//if($old['tambah_aset']==0 && $fmTAMBAHASET ==1 ) jurnalHapusSebagian($idplh,$UID, 1); //$errmsg= $plh['cek']; $sukses=FALSE;						//if($old['tambah_aset']==1 && $fmTAMBAHASET ==0 ) jurnalHapusSebagian($idplh,$UID, 3);					}						}																					}										if($sukses){				//KosongkanField("fmIDBARANG,fmNMBARANG,fmMEREK,fmJUMLAH,fmSATUAN,fmHARGASATUAN,fmJENISBARANG,fmKET,fmTANGGALSKGUBERNUR,fmNOSKGUBERNUR,fmKONDISIBAIK,fmKONDISIKURANGBAIK,fmTANGGALBELI");				//$errmsg = 'Data telah di ubah dan simpan';							}else{				if($errmsg ==''){					$errmsg = 'Data Tidak dapat di ubah atau di simpan'.$aqry;					};							}		}	}else{		$errmsg = 'Gagal Simpan Data. Anda Tidak Mempunyai Hak Akses!';		}	return $errmsg;}function HapusSebagian_GetData($id){	global $fmNOREG, $fmTANGGALPENGHAPUSAN,			$fmSURATNOMOR,$fmURAIAN,  			$fmSURATTANGGAL, $fmHARGA_AWAL,$fmHARGA_HAPUS, $fmHARGA_AWAL,$fmHARGA_SCRAP, $fmKET,$fmTANGGALPEROLEHAN,$idbi_awal;	global $idbi; //idbi nya					$aqry = "select * from penghapusan_sebagian where id = '$id'";	$qry = mysql_query($aqry);	if ($isi = mysql_fetch_array($qry)){		$fmTANGGALPENGHAPUSAN = $isi['tgl_penghapusan']=='0000-00-00'? '': $isi['tgl_penghapusan'];		$fmTANGGALPEROLEHAN = $isi['tgl_perolehan']=='0000-00-00'? '': $isi['tgl_perolehan'];		$fmSURATNOMOR = $isi['surat_no'];		$fmURAIAN = $isi['uraian'];		$fmSURATTANGGAL = $isi['surat_tgl'] == '0000-00-00'? '': $isi['surat_tgl'];//'2010-02-15';		$fmHARGA_HAPUS = $isi['harga_hapus'];		$fmHARGA_AWAL = $isi['harga_awal'];		$fmHARGA_SCRAP = $isi['harga_scrap'];		$fmKET = $isi['ket'];		$idbi= $isi['id_bukuinduk'];		$idbi_awal= $isi['idbi_awal'];	}		}function HapusSebagian_FormEntry(){	global $fmNOREG, $fmTANGGALPENGHAPUSAN, 			$fmSURATNOMOR,$fmURAIAN, 			$fmSURATTANGGAL,$fmHARGA_AWAL,  $fmHARGA_HAPUS,$fmHARGA_SCRAP, $fmKET ,$fmTANGGALPEROLEHAN;		global   $ActEntry, $AmbilData,$idbi,$idbi_awal;			//$fmst, $idbi, $idbi_awal, $idplh, 	global $Main;		//echo ",fmTAMBAHASET=$fmTAMBAHASET";//if ( $fmTAMBAHASET  ) $fmTAMBAHASET = 1; //default//echo ",fmTAMBAHASET=$fmTAMBAHASET";// $fmTmbahAset_checked =$fmTAMBAHASET==1?'checked':'';$space = formEntryBase2('','','',"","",'','valign="middle" height="8"');	return "		<A NAME='FORMENTRY'></A>		<div><div>$FormEntry_Script					$FormEntry_Hidden		<input type='hidden' name='idbi_awal' id='idbi_awal' value='".$idbi_awal."' >		<input type='hidden' name='idplh' id='idplh' value='".$_GET['idplh']."' >		<input type='hidden' name='fmst' id='fmst' value='".$_GET['fmst']."' >		<input type='hidden' name='idbi_awal' id='idbi_awal' value='".$idbi."' >		</div></div>		<table width=\"100%\"  height='100%' class=\"adminform\" style='border-width:0'><tr><td valign='top' style='padding:8;'>	<table width='100%'>					".formEntryBase2('Tanggal Buku Penghapusan',':',				createEntryTgl('fmTANGGALPENGHAPUSAN', $fmTANGGALPENGHAPUSAN, false, '','','FormHapusSebagian','2').				'&nbsp&nbsp<span style="color: red;"></span>'				,"style='width:180'","style='width:10'",'','valign="middle" height="21"')."		".formEntryBase2('Tanggal Perolehan',':',				createEntryTgl('fmTANGGALPEROLEHAN',$fmTANGGALPEROLEHAN, false, '','','FormHapusSebagian').				'&nbsp&nbsp<span style="color: red;"></span>'				,"style=''","style=''",'','valign="middle" height="21"')."	".formEntryBase2('Uraian',':',		"<textarea name=\"fmURAIAN\"  id=\"fmURAIAN\" cols='47' >$fmURAIAN</textarea>"		,"style=''","style=''",'','valign="top" height="21"')."	".formEntryBase2('Surat Keputusan','','',"style=''","style=''",'','valign="middle" height="21"')."			".formEntryBase2('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nomor',':',		txtField('fmSURATNOMOR',$fmSURATNOMOR,'100','46','text')		,"style=''","style=''",'','valign="middle" height="21"')."		".formEntryBase2('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tanggal',':',				createEntryTgl('fmSURATTANGGAL', $fmSURATTANGGAL, false, '', '','FormHapusSebagian').				'&nbsp&nbsp<span style="color: red;"></span>'				,'','','','valign="middle" height="24"')."	".formEntryBase2('Nilai Perolehan',':',			'Rp.'.inputFormatRibuan("fmHARGA_AWAL", 			 	($entryMutasi==FALSE? '':' readonly="" ') ),'','','','valign="top" height="21"')."		".formEntryBase2('Nilai Penghapusan',':',			'Rp.'.inputFormatRibuan("fmHARGA_HAPUS", 			 	($entryMutasi==FALSE? '':' readonly="" ') ),'','','','valign="top" height="21"')."			".formEntryBase2('Nilai Scrap/Sisa',':',			'Rp.'.inputFormatRibuan("fmHARGA_SCRAP", 			 	($entryMutasi==FALSE? '':' readonly="" ') ),'','','','valign="top" height="21"')."			".formEntryBase2('Keterangan',':',		"<textarea name=\"fmKET\"  id=\"fmKET\" cols='47' >$fmKET</textarea>"		,"style=''","style=''",'','valign="top" height="21"')."	</table></td></tr>	</table>		";}function HapusSebagian_List($Tbl, $Fields='*', $Kondisi='', $Limit='', $Order='', $Style=1, $TblStyleClass='koptable', 	$Cetak=FALSE,$NoAwal=0, $ReadOnly=FALSE, $fmKIB='',$xls=FALSE){	//style(list,header, jml hal, jml tot, hal, menu)		global $Main, $jmlTampilPLH;		$TdStyle=$Cetak ? 'GarisCetak':'GarisDaftar';		//list ------------------------------------	//if ($Style[0]==1){	$no=$NoAwal;//$Main->PagePerHal * (($HalPLH*1) - 1);	$jmlTampilPLH= 0;	$cb = 0;			$aqry="select $Fields from $Tbl $Kondisi $Order $Limit "; // echo " $aqry<br>";	$Qry = mysql_query($aqry);			while ($isi = mysql_fetch_array($Qry)){			$jmlTampilPLH++;		$no++;		$jmlTotalHargaDisplay += $isi['harga_hapus'];		$jmlTotalScrapDisplay += $isi['harga_scrap'];		$persen_hapus=($isi['harga_hapus']/$isi['harga_awal'])*100;		$kdBarang = $isi['f'].$isi['g'].$isi['h'].$isi['i'].$isi['j'];		$kdKelBarang = $isi['f'].$isi['g']."00";		$nmBarang = mysql_fetch_array(mysql_query("select * from ref_barang where concat(f,g,h,i,j)='$kdBarang'"));		$nmKelBarang = mysql_fetch_array(mysql_query("select * from ref_barang where concat(f,g,h)='$kdKelBarang'"));		$clRow = $no % 2 == 0 ?"row1":"row0";				global $ISI5, $ISI6;												$ISI5 = ''; $ISI6 = '';					$KondisiKIB = "	where a1= '{$isi['a1']}' and a = '{$isi['a']}' and 	c = '{$isi['c']}' and d = '{$isi['d']}' and e = '{$isi['e']}' and e1 = '{$isi['e1']}' and 					f = '{$isi['f']}' and g = '{$isi['g']}' and h = '{$isi['h']}' and i = '{$isi['i']}' and j = '{$isi['j']}' and 					tahun = '{$isi['thn_perolehan']}' and noreg = '{$isi['noreg']}'  ";				//echo "KondisiKIB=$KondisiKIB";		if($fmKIB==''){			Penatausahaan_BIGetKib($isi['f'], $KondisiKIB );		}else{			Penatausahaan_BIGetKib_hapus($isi['f'], $KondisiKIB );			}		$tampilAlamat = $Style ==1? '':		"<td class='$TdStyle' align=left>$ISI5</td>	<td class='$TdStyle' align=left>$ISI6</td>	";				$TampilCheckBox = $Cetak? '' : "<td class=\"$TdStyle\" align='center'><input type=\"checkbox\" id=\"cbPLH$cb\" name=\"cidPLH[]\" value=\"{$isi['id']}\" onClick=\"isChecked2(this.checked,'HapusSebagian_checkbox');\" />&nbsp;</td>";		$TampilCheckBoxKol1 = $Style==1? '' : $TampilCheckBox;					$TampilCheckBoxKol2 = $Style==1? $TampilCheckBox	: '';					$List_ = $Style==2?			"<td class=\"$TdStyle\" align=center>{$isi['f']}.{$isi['g']}.{$isi['h']}.{$isi['i']}.{$isi['j']}</td>			<td class=\"$TdStyle\" align=center>{$isi['noreg']}</td>			<td class=\"$TdStyle\">{$nmBarang['nm_barang']} </td>			<td class=\"$TdStyle\">$ISI5 xx</td>			<td class=\"$TdStyle\" align=center>{$isi['thn_perolehan']}</td>"			:"";				/*$CheckBox = $Style==1?			"<td class=\"$TdStyle\" align='center'><input type=\"checkbox\" id=\"cbPLH$cb\" name=\"cidPLH[]\" value=\"{$isi['id']}\" onClick=\"isChecked2(this.checked,'Pelihara_checkbox');\" />&nbsp;</td>"			:"";		*/		if ($xls){		$List_ = 			"<td class=\"$TdStyle\" align=center valign=top>{$isi['f']}.{$isi['g']}.{$isi['h']}.{$isi['i']}.{$isi['j']}</td>			<td class=\"$TdStyle\" align=center valign=top><div class=nfmt3>{$isi['noreg']}</div></td>			<td class=\"$TdStyle\" valign=top>{$nmBarang['nm_barang']} </td>			<td class=\"$TdStyle\">$ISI5</td>			<td class=\"$TdStyle\" align=center valign=top>{$isi['thn_perolehan']}</td>";							$ListData .= "				<tr class='$clRow' height='21'>			<td class=\"$TdStyle\" align=center valign=top>$no</td>			$TampilCheckBoxKol1			$List_			<td class=\"$TdStyle\" valign=top>{$isi['uraian']}</td>			<td class=\"$TdStyle\" valign=top>{$isi['surat_no']}</td>			<td class=\"$TdStyle\" align=center valign=top>".TglInd($isi['surat_tgl'])."</td>			<td class=\"$TdStyle\" align=right valign=top>".number_format(($isi['harga_awal']), 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=right valign=top>".number_format(($isi['harga_hapus']), 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=center valign=top>".number_format($persen_hapus, 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=right valign=top>".number_format(($isi['harga_scrap']), 2, ',', '.')."</td>			<td class=\"$TdStyle\" valign=top>{$isi['ket']}<br>".TglInd($isi['tgl_penghapusan'])."</td>			<td class=\"$TdStyle\" align=center>".TglInd($isi['tgl_penghapusan'])."</td>			$TampilCheckBoxKol2			</tr>		";					} else {		$ListData .= "				<tr class='$clRow' height='21'>			<td class=\"$TdStyle\" align=center>$no</td>			$TampilCheckBoxKol1			$List_			<td class=\"$TdStyle\">{$isi['uraian']}</td>			<td class=\"$TdStyle\">{$isi['surat_no']}</td>			<td class=\"$TdStyle\" align=center>".TglInd($isi['surat_tgl'])."</td>			<td class=\"$TdStyle\" align=right>".number_format(($isi['harga_awal']), 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=right>".number_format(($isi['harga_hapus']), 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=center>".number_format($persen_hapus, 2, ',', '.')."</td>			<td class=\"$TdStyle\" align=right>".number_format(($isi['harga_scrap']), 2, ',', '.')."</td>			<td class=\"$TdStyle\">{$isi['ket']}<br>".TglInd($isi['tgl_penghapusan'])."</td>			<td class=\"$TdStyle\">".TglInd($isi['tgl_perolehan'])."</td>			$TampilCheckBoxKol2			</tr>		";					}		$cb++;	}			//}		//header-----------------------------------		if($fmKIB=='01' || $fmKIB=='03' || $fmKIB=='04' || $fmKIB=='06' ){		$tampilMerk = "<th class='th01' style='width:200'>Alamat</th>";	}else{		$tampilMerk = "<th class='th01' width='70'>Merk/ Tipe</th>";		}	if($fmKIB=='01' ){		$tampilSert = "<th class=\"th01\" width='70'>No. Sertifikat/ Tanggal/ Hak</th>";	}else if( $fmKIB=='03' || $fmKIB=='04' || $fmKIB=='06' ){		$tampilSert = "<th class=\"th01\" width='70'>No. Dokumen/ Tanggal </th>";	}else{		$tampilSert = "<th class=\"th01\" width='70'>No. Sertifikat/ No. Pabrik/ No. Chasis/ No. Mesin</th>";		}	$tampilSertMerk	= $tampilMerk .$tampilSert;		$TampilCheckBox = $Cetak? '' : "<TH class=\"th01\"  style='width:30'><input type=\"checkbox\" name=\"HapusSebagian_toggle\" value=\"\" onClick=\"checkAll1b($jmlTampilPLH,'cbPLH','HapusSebagian_toggle','HapusSebagian_checkbox');\" /></TH>";	$TampilCheckBoxKol1 = $Style==1? '' : $TampilCheckBox;		$TampilCheckBoxKol2 = $Style==1? $TampilCheckBox	: '';			$Head1 = $Style==2?		"		<TH class=\"th01\" rowspan=2 style='width:200'>Nama Barang</TH>				<TH class=\"th01\" rowspan=2 style='width:200'>Alamat</TH>				<TH class=\"th01\" rowspan=2>Tahun<br>Perolehan</TH>"		:"";	$Head2 =  $Style==2?		"		"		: '';			/*$CheckBox = $Style==1?		"<TH class=\"th01\" rowspan=2 style='width:30'><input type=\"checkbox\" name=\"Pelihara_toggle\" value=\"\" onClick=\"checkAll1b($jmlTampilPLH,'cbPLH','Pelihara_toggle','Pelihara_checkbox');\" /></TH>"		:"";*/		$HapusSebagian_header = 		"<TR>			<TH class=\"th02\" colspan=".($Cetak?'3':'4')." style='width:40'>No</TH>			$Head1			<TH class=\"th01\" rowspan=2 style=''>Uraian<br>Penghapusan</TH>			<TH class=\"th02\" colspan=2>Surat Keputusan</TH>			<TH class=\"th01\" rowspan=2  style='width:100'>Nilai Perolehan</TH>			<TH class=\"th02\" colspan=2  style='width:100'>Penghapusan</TH>			<TH class=\"th01\" rowspan=2  style='width:100'>Nilai Scrap/Sisa</TH>			<TH class=\"th01\" rowspan=2 style='width:100'>Keterangan/<br>Tgl.&nbsp;Penghapusan</TH>			<TH class=\"th01\" rowspan=2 style='width:100'>Tgl.&nbsp;Perolehan</TH>			$TampilCheckBoxKol2		</TR>		<TR>			$Head2			<TH class=\"th01\" style='width:40'>No</TH>			$TampilCheckBoxKol1			<TH class=\"th01\" style='width:100'>Kode Barang</TH>			<TH class=\"th01\" style='width:40'>Reg.</TH>						<TH class=\"th01\" style='width:75'>Nomor</TH>			<TH class=\"th01\" style='width:60'>Tanggal</TH>			<TH class=\"th01\"  style='width:100'>Nilai</TH>			<TH class=\"th01\"  >(%)</TH>		</TR>		";	//}		//total & Hal ----------------------------------------------------------	if ($Style==2 && $Cetak==FALSE ){					//total ------------		$totalHal = "			<tr class='row0'>			<td colspan=11 class=\"$TdStyle\">Total Harga per Halaman </td>			<td align=right class=\"$TdStyle\"><b>".number_format(($jmlTotalHargaDisplay), 2, ',', '.')."</td>			<td class=\"$TdStyle\">&nbsp;</td>			<td align=right class=\"$TdStyle\"><b>".number_format(($jmlTotalScrapDisplay), 2, ',', '.')."</td>			<td class=\"$TdStyle\">&nbsp;</td>			<td class=\"$TdStyle\">&nbsp;</td>			</tr>";			$aqry = "select sum(harga_hapus) as total,sum(harga_scrap) as total_scrap  from $Tbl $Kondisi";//  echo " $aqry<br>";//		$jmlTotalHarga =  table_get_value($aqry,'total');	$Qry = mysql_query($aqry);			while ($isi = mysql_fetch_array($Qry)){		$jmlTotalHarga=$isi['total'];			$jmlTotalHargaScrap=$isi['total_scrap'];		}				if ($xls){		$totalAll = "			<tr class='row0'>			<td class=\"$TdStyle\" colspan=10 >Total Harga Seluruhnya </td>			<td class=\"$TdStyle\" align=right><b>".number_format(($jmlTotalHarga), 2, '.', '')."</td>			<td class=\"$TdStyle\" >&nbsp;</td>			<td class=\"$TdStyle\" align=right><b>".number_format(($jmlTotalHargaScrap), 2, '.', '')."</td>			<td class=\"$TdStyle\" >&nbsp;</td>			<td class=\"$TdStyle\" >&nbsp;</td>			</tr>";					} else {		$totalAll = "			<tr class='row0'>			<td class=\"$TdStyle\" colspan=11 >Total Harga Seluruhnya </td>			<td class=\"$TdStyle\" align=right><b>".number_format(($jmlTotalHarga), 2, ',', '.')."</td>			<td class=\"$TdStyle\" >&nbsp;</td>			<td class=\"$TdStyle\" align=right><b>".number_format(($jmlTotalHargaScrap), 2, ',', '.')."</td>			<td class=\"$TdStyle\" >&nbsp;</td>			<td class=\"$TdStyle\" >&nbsp;</td>			</tr>";					}		//Hal --------------			$aqry = "select count(*) as cnt  from $Tbl $Kondisi"; // echo " $aqry";		$jmlDataPLH =  table_get_value($aqry,'cnt');		$Hal = "<tr>				<td colspan=19 align=center>".Halaman($jmlDataPLH,$Main->PagePerHal,"HalPLH")."</td>			</tr>";	}	if ($Cetak){		$totalHal = "			<tr class='row0'>			<td colspan=10 class=\"$TdStyle\">Total </td>			<td align=right class=\"$TdStyle\"><b>".number_format(($jmlTotalHargaDisplay), 2, ',', '.')."</b></td>			<td class=\"$TdStyle\">&nbsp;</td>			<td align=right class=\"$TdStyle\"><b>".number_format(($jmlTotalScrapDisplay), 2, ',', '.')."</b></td>			<td class=\"$TdStyle\">&nbsp;</td>			<td class=\"$TdStyle\">&nbsp;</td>			</tr>";		}			//menu ----------------------------------------------------------	if ($Style==1){		$Hapussebagian_Menu = $ReadOnly? '':			"<li><a href='javascript:HapusSebagianHapus.Hapus()' title='Hapus Penghapusan' class='btdel'></a></li>			<li><a href='javascript:HapusSebagianForm.Edit()' title='Edit Penghapusan' class='btedit'></a>				<ul id='bgn_ulEntry'>					<li style='width:470;top:-4;z-index:99;'></li>				</ul>			</li>			<li><a  href='javascript:HapusSebagianForm.Baru()' title='Tambah Penghapusan' class='btadd'></a>				<ul id='bgn_ulEntry'>					<li style='width:470;top:-4;z-index:99;'>	</li>				</ul>			</li>	";		$Hapussebagian_Menu=			"<table class='' width='100%' cellspacing='0' cellpadding='0' border='0'><tr><td style='padding:0'>			<div class='menuBar2' style='' >			<ul>			$Hapussebagian_Menu			<li><a  href='javascript:HapusSebagianRefresh.Refresh()' title='Refresh Penghapusan' class='btrefresh'></a></li>			</ul>				<a id='HapusSebagian_jmldata' style='cursor:default;position:relative;left:2;top:2;color:gray;font-size:11;' title='Jumlah Penghapusan'>[ $jmlTampilPLH ]</a>				</div>			</td></tr></table>";			//echo "jmlTampilPLH = $jmlTampilPLH";	}				return "			$Hapussebagian_Menu			<table class='$TblStyleClass' border='1' width='100%'  >			$HapusSebagian_header			$ListData						$totalHal			$totalAll			$Hal			</table>			<input type='hidden' value='' id='HapusSebagian_checkbox' >			<input type='hidden' value='$jmlTampilPLH' id='jmlTampilPLH' >			"			;}function HapusSebagian_Hapus(){	global $Main;	$errmsg='';$Del = FALSE;	$cidPLH= $_GET['cidPLH'];	for($i = 0; $i<count($cidPLH); $i++)	{		//$id= $cidPLH[$i]; //$str.=$id.'-';		if($errmsg ==''){			//ambil id buku induk			$HapusSebagian = mysql_fetch_array(mysql_query(				"select idbi_awal, tgl_penghapusan, id_bukuinduk from penghapusan_sebagian where id='{$cidPLH[$i]}'"			));					$fmTANGGALPENGHAPUSAN = $HapusSebagian['tgl_penghapusan'];			$idbi_awal = $HapusSebagian['idbi_awal'];			//cek status barangnya			$penatausaha = mysql_fetch_array(mysql_query(				"select status_barang from buku_induk where id='{$HapusSebagian['id_bukuinduk']}'"			));			if ($errmsg =='' && $penatausaha['status_barang']==3 ) $errmsg = "Gagal Hapus. Barang untuk Penghapusan ini sudah dihapuskan!";			if ($errmsg =='' && $penatausaha['status_barang']==4 ) $errmsg = 'Gagal Hapus. Barang untuk Penghapusan ini sudah dipindah tangankan!';			if ($errmsg =='' && $penatausaha['status_barang']==5 ) $errmsg = 'Gagal Hapus. Barang untuk Penghapusan ini sudah diganti rugi!';			//cek ada tgl_koreksi dan tgl_koreksi > tgl_penghapusan			$get_koreksi = mysql_fetch_array(mysql_query("select count(*) as cnt from t_koreksi where idbi_awal='$idbi_awal' and tgl>'$fmTANGGALPENGHAPUSAN'"));			//$errmsg="old=".$old_pengaman['biaya_pengamanan'];			if($get_koreksi['cnt']>0 )$errmsg = 'Data tidak bisa di hapus,Tanggal koreksi melebihi tanggal penghapusan !';			//--------------------------------------		}			// cek tanggal 		$xid=$cidPLH[$i];		if ($errmsg=='') $errmsg=HapusSebagian_CekdataCutoff('hapus',$xid,'');			if($errmsg==''){						$Del = mysql_query("delete from penghapusan_sebagian where id='{$cidPLH[$i]}' limit 1");			if (!$Del){				$errmsg = "Gagal Hapus ID {$cidPLH[$i]} ";			}else{				if($Main->MODUL_JURNAL) jurnalHapusSebagian($cidPLH[$i],'',3);			}		}				if($errmsg != '') break;	}	return $errmsg;}function HapusSebagian_createScriptJs($Style=1){	switch( $Style){		case 1:{			return "				<div><div><script>				HapusSebagianRefresh= new AjxRefreshObj('HapusSebagianList','HapusSebagian_cover', 'divHapusSebagianList', new Array('idbi_awal') );				HapusSebagianSimpan= new AjxSimpanObj('HapusSebagianSimpan','HapusSebagianSimpan_cover',					new Array('fmTANGGALPENGHAPUSAN','fmURAIAN',						'fmSURATNOMOR','fmSURATTANGGAL','fmHARGA_AWAL','fmHARGA_HAPUS','fmHARGA_SCRAP',						'fmKET','idbi','idbi_awal','idplh','fmst', 'fmTANGGALPEROLEHAN'),						'HapusSebagianForm.Close();HapusSebagianRefresh.Refresh();' );				HapusSebagianForm= new AjxFormObj('HapusSebagianForm','HapusSebagian_cover','HapusSebagian_checkbox','jmlTampilPLH', 					'cbPLH', new Array('idbi','idbi_awal'), 'document.getElementById(\'fmTANGGALPENGHAPUSAN_tgl\').focus()');				HapusSebagianHapus= new AjxHapusObj('HapusSebagianHapus',  'HapusSebagian_cover', 'HapusSebagian_checkbox', 'jmlTampilPLH', 					'cbPLH', 'cidPLH', 'HapusSebagianRefresh.Refresh();');							</script></div></div>			";					break;		}		case 2:{			$refresh= 'adminForm.submit()';//document.getElementById(\'btTampil\').click()';			return "				<div><div><script>				HapusSebagianSimpan= new AjxSimpanObj('HapusSebagianSimpan','HapusSebagianSimpan_cover',					new Array('fmTANGGALPENGHAPUSAN','fmURAIAN',						'fmSURATNOMOR','fmSURATTANGGAL','fmHARGA_AWAL','fmHARGA_HAPUS','fmHARGA_SCRAP',						'fmKET','idplh','fmst', 'fmTANGGALPEROLEHAN', 'idbi_awal'),						'HapusSebagianForm.Close();$refresh' );				HapusSebagianForm= new AjxFormObj('HapusSebagianForm','HapusSebagian_cover','HapusSebagian_checkbox','jmlTampilPLH', 					'cbPLH', new Array(), 'document.getElementById(\'fmTANGGALPENGHAPUSAN_tgl\').focus()');				HapusSebagianHapus= new AjxHapusObj('HapusSebagianHapus',  'HapusSebagian_cover', 'HapusSebagian_checkbox', 'jmlTampilPLH', 					'cbPLH', 'cidPLH', '$refresh');							</script></div></div>			";					break;		}			} 	}function HapusSebagian_CekdataCutoff($mode='insert',$id='',$tgl='',$idbi=''){global $Main;$usrlevel=$Main->UserLevel;$errmsg='';if ($usrlevel!='1'){	$tglcutoff=$Main->TAHUN_CUTOFF."-12-31";switch ($mode){	case 'insert':{	if ($tgl<$tglcutoff) $errmsg="Tgl. penghapusan(".$tgl.") lebih kecil dari  tgl. cut off (".$tglcutoff.")";		 		break;}case 'edit':{//	if ($tgl<$tglcutoff) $errmsg="Data dengan tgl. penghapusan lebih kecil dari tgl. ".$tglcutoff; 			//cek tanggal buku	if ($errmsg==''){			$datax = mysql_fetch_array(mysql_query(				"select * from penghapusan_sebagian where id='$id'"));			$tgl=$datax['tgl_penghapusan'];					if ($tgl<=$tglcutoff)				$errmsg="Data dengan tgl. penghapusan(".$tgl.") lebih kecil dari tgl. cut off (".$tglcutoff.") tidak dapat diedit";	}		break;}case 'hapus':{	if ($errmsg==''){			$datax = mysql_fetch_array(mysql_query(				"select * from penghapusan_sebagian where id='$id'"));			$tgl=$datax['tgl_penghapusan'];				if ($tgl<=$tglcutoff)				$errmsg="Data dengan tgl. penghapusan(".$tgl.") lebih kecil dari tgl. cut off (".$tglcutoff.") tidak dapat dihapus";	}		break;}	}}return $errmsg;}function HapusSebagian_GetHargaPerolehanBI($id=''){			$datax = mysql_fetch_array(mysql_query(				"select jml_harga from buku_induk where id='$id' limit 1"));				return $datax['jml_harga'];	}?>