<?phpglobal $tmpdir;global $datawarna;$datawarna=array('#85eD82',            '#F7b7b7',            '#CFDF49',            '#88d8f2',            '#07AF7B',            '#B9E3F9',            '#FFF3AD',            '#EF606A',            '#EC8833',            '#FFF100',            '#87C9A5',			            '#CFE7FB',            '#F9D76F',            '#B9D566',            '#FFBB90',            '#66BBBB',            '#E69090',            '#BB90BB',            '#9AB67C',            '#D1CC66',            '#AFD8F8',            '#F6BD0F',            '#8BBA00',            '#FF8E46',            '#008E8E',            '#D64646',            '#8E468E',            '#588526',            '#B3AA00',            '#008ED6',            '#9D080D',            '#A186BE',            '#183152',            '#C4D7ED',            '#375D81',            '#ABC8E2',            '#E1E6FA',            '#9BBAB2',            '#3B4259',            '#0063BC',            '#1D5A73',            '#ABABFF',            '#27ADC5',            '#EDFFCC',            '#66FFFF',            '#00AABB',            '#00FFCC',            '#33CCFF',            '#008866',            '#99FFFF',            '#0099FF',            '#99FFCC',            '#3399FF',            '#2277FF',            '#445588',            '#003388',            '#338877',            '#55DDFF',            '#00FF99',            '#BBBBBB',            '#77AAFF',            '#00FFCC');$kolomdata1=array();$kolomdata2=array();$kolomdata3=array();$kolomdatap1=array();$kolomdatap2=array();$kolomlabel1=array();$kolomlabel2=array();$kolomlabel3=array();$kolomlabelno=array();$kolomtitle1=array();$kolomtitle2=array();$kolomtitle3=array();function GetColorList() {        return array(            '#85eD82',            '#F7b7b7',            '#CFDF49',            '#88d8f2',            '#07AF7B',            '#B9E3F9',            '#FFF3AD',            '#EF606A',            '#EC8833',            '#FFF100',            '#87C9A5',			            '#CFE7FB',            '#F9D76F',            '#B9D566',            '#FFBB90',            '#66BBBB',            '#E69090',            '#BB90BB',            '#9AB67C',            '#D1CC66',            '#AFD8F8',            '#F6BD0F',            '#8BBA00',            '#FF8E46',            '#008E8E',            '#D64646',            '#8E468E',            '#588526',            '#B3AA00',            '#008ED6',            '#9D080D',            '#A186BE',            '#183152',            '#C4D7ED',            '#375D81',            '#ABC8E2',            '#E1E6FA',            '#9BBAB2',            '#3B4259',            '#0063BC',            '#1D5A73',            '#ABABFF',            '#27ADC5',            '#EDFFCC',            '#66FFFF',            '#00AABB',            '#00FFCC',            '#33CCFF',            '#008866',            '#99FFFF',            '#0099FF',            '#99FFCC',            '#3399FF',            '#2277FF',            '#445588',            '#003388',            '#338877',            '#55DDFF',            '#00FF99',            '#BBBBBB',            '#77AAFF',            '#00FFCC',        );    }function GetNamaOPD() { 	global $fmWIL,$fmSKPD,$fmUNIT,$fmSUBUNIT,$fmKEPEMILIKAN,$fmWIL;	global $KEPEMILIKAN,$WILAYAH,$SKPD,$UNIT,$SUBUNIT;  	$KEPEMILIKAN = mysql_fetch_array(mysql_query("select nm_pemilik from ref_pemilik where a1='$fmKEPEMILIKAN'"));	$KEPEMILIKAN = $KEPEMILIKAN[0]; 	/*$WILAYAH = mysql_fetch_array(mysql_query("select nm_wilayah from ref_wilayah where b='$fmWIL' "));	$WILAYAH = $WILAYAH[0]; */	$WILAYAH = '-';	$SKPD = mysql_fetch_array(mysql_query("select nm_skpd from ref_skpd where d='00' and c='$fmSKPD' "));	$SKPD = $SKPD[0]; 	$UNIT = mysql_fetch_array(mysql_query("select nm_skpd from ref_skpd  where  c='$fmSKPD' and d <> '00' and e = '00' and d='$fmUNIT' "));	$UNIT = $UNIT[0]; 	$SUBUNIT = mysql_fetch_array(mysql_query("select nm_skpd from ref_skpd  where  c='$fmSKPD' and d = '$fmUNIT' and e <> '00' and e='$fmSUBUNIT' "));	$SUBUNIT = $SUBUNIT[0]; }function GetNamaBarang() { 	global $fmBIDANG,$fmKELOMPOK,$fmSUBKELOMPOK,$fmSUBSUBKELOMPOK;	global $BIDANG_BARANG,$KELOMPOK_BARANG,$SUBKELOMPOK_BARANG,$SUBSUBKELOMPOK_BARANG;  	$BIDANG_BARANG = mysql_fetch_array(mysql_query("select nm_barang from ref_barang where g='00' and f='$fmBIDANG' "));	$BIDANG_BARANG = $BIDANG_BARANG[0];	$KELOMPOK_BARANG = mysql_fetch_array(mysql_query("select nm_barang from ref_barang where f='$fmBIDANG' g<>'00' and g='$fmKELOMPOK' and h='00' "));	$KELOMPOK_BARANG = $KELOMPOK_BARANG[0];	$SUBKELOMPOK_BARANG = mysql_fetch_array(mysql_query("select nm_barang from ref_barang where f='$fmBIDANG' and g='$fmKELOMPOK' and h<>'00' and h='$fmSUBKELOMPOK' "));	$SUBKELOMPOK_BARANG = $SUBKELOMPOK_BARANG[0];	$SUBSUBKELOMPOK_BARANG = mysql_fetch_array(mysql_query("select nm_barang from ref_barang where f='$fmBIDANG' and g='$fmKELOMPOK' and h='$fmSUBKELOMPOK' and i<>'00' i='$fmSUBSUBKELOMPOK'"));	$SUBSUBKELOMPOK_BARANG = $SUBSUBKELOMPOK_BARANG[0];	 }function gentmpfile($dir=''){do {  $filename = rand();//  $filename .= str_replace('.', '_', microtime());  $filename .= getmypid();  $filename .= '.png';} while(file_exists($dir.$filename));return $filename;	}function separator1000($aVal) {    return number_format($aVal,0,',','.');}function getdaftar1($modedata=0){global $kolomtitle1,$kolomtitle2,$kolomtitle3;global $kolomdata1,$kolomdata2,$kolomdata3,$kolomdatap1,$kolomdatap2;		global $ada_data,$JmlTotData,$jmlTotHarga,$jmlTotBarang;global $fmWIL,$fmSKPD,$fmUNIT,$fmSUBUNIT,$fmKEPEMILIKAN,$fmWIL;global $KEPEMILIKAN,$WILAYAH,$SKPD,$UNIT,$SUBUNIT;  		global $datawarna,$COrder;$tmpfmSKPD=$fmSKPD;$TitleJml='Perolehan';switch ($COrder){case 'Perolehan':{ $TitleJml='Perolehan';break;	}case 'Barang':{ $TitleJml='Barang';break;	}		} $isi='<div align="center"><table  border="1" cellpadding="0" cellspacing="0" style="background-color:white;" ><tr  style="background-color:#E6E6E6; font-size:12; color:black;">				<th style="color:black;" width="40">No.</th>				<th style="color:black;" width="20">&nbsp;</th>				<th style="color:black;" width="400">Bidang / OPD / Unit</th>  			    <th style="color:black;" width="100">Jumlah '.$TitleJml.' (%)</th>				</tr>';$clGaris='GarisDaftar';$jmldata = count($kolomtitle1);$jmlwarna = count($datawarna);$tkodec='-';$tkoded='-';$tkodee='-';$tkodecde='00.00.00';for ($i=1;$i<=$jmldata;$i++){if ($COrder=='Barang'){$jdata=$kolomdata2[$i-1]*100/$jmlTotBarang;	} else {$jdata=$kolomdata1[$i-1]*100/$jmlTotHarga;	}$nowarna =($i-1)%$jmlwarna;$kodecde=$kolomtitle3[$i-1];$kodec=substr($kodecde,0,2);$koded=substr($kodecde,3,2);$kodee=substr($kodecde,6,2);if ($kodec!='00' && $koded!='00'){	if ($kodec!=$tkodec)	{	$fmSKPD=$kodec;	$fmUNIT='00';	$fmSUBUNIT='00';	GetNamaOPD();	$isi .='	<tr class "row0" >	<td class="'.$clGaris.'" align=right>&nbsp;</td>	<td class="'.$clGaris.'" align=right>&nbsp;</td>		<td class="'.$clGaris.'" align=left><b>'.$SKPD.'</b></td>		<td class="'.$clGaris.'" align=right>&nbsp;</td>		</tr>';		$tkodec=$kodec;	$tkoded='';			}}if ($koded!='00' && $kodee!='00'){	if ($koded!=$tkoded)	{	$fmSKPD=$kodec;	$fmUNIT=$koded;	$fmSUBUNIT='00';	GetNamaOPD();		$isi .='	<tr class "row0" >	<td class="'.$clGaris.'" align=right>&nbsp;</td>	<td class="'.$clGaris.'" align=right>&nbsp;</td>		<td class="'.$clGaris.'" align=left style="padding-left:24"><b>'.$UNIT.'</b></td>		<td class="'.$clGaris.'" align=right>&nbsp;</td>		</tr>';		$tkoded=$koded;		}}$isi .='<tr class "row0" ><td class="'.$clGaris.'" align=right>'.$i.'.</td><td class="'.$clGaris.'" align=right><div style="background-color:'.$datawarna[$nowarna].'">&nbsp;</div></td>	<td class="'.$clGaris.'" align=left style="padding-left:44">'. $kolomtitle1[$i-1].' </td>	<td class="'.$clGaris.'" align=right>'. number_format($jdata,2,',','.') .'</td>	</tr>';	}$isi .='</table></div>';				 $fmSKPD=$tmpfmSKPD;return $isi;}function getOptchart1( $doCari, $addPageParam  ){global $fmWIL,$fmSKPD,$fmUNIT,$fmSUBUNIT;global $fmBIDANG;		if ($fmBIDANG=='') $fmBIDANG="00";		if ($fmSKPD=='') $fmSKPD="00";		$Ops='<option  '.($fmBIDANG=="00"?"selected":"").' value="00">--- Semua KIB ---</option>		<option '.($fmBIDANG=="01"?"selected":"").' value="01">KIB A TANAH</option>		<option '.($fmBIDANG=="02"?"selected":"").' value="02">KIB B PERALATAN DAN MESIN</option>		<option '.($fmBIDANG=="03"?"selected":"").' value="03">KIB C GEDUNG DAN BANGUNAN</option>		<option '.($fmBIDANG=="04"?"selected":"").' value="04">KIB D JALAN, IRIGASI DAN JARINGAN</option>		<option '.($fmBIDANG=="05"?"selected":"").' value="05">KIB E ASET TETAP LAINNYA</option>		<option '.($fmBIDANG=="06"?"selected":"").' value="06">KIB F KONTRUKSI DALAM PENGERJAAN</option>		';$ListKIB= 		"<select ".$fmBIDANG." name='fmBIDANG' >".$Ops.		"</select>";		$Ops='<option '.($fmSKPD=="00"?"selected":"").' value="00">BIDANG</option>		<option '.($fmSKPD=="01"?"selected":"").' value="01">ASISTEN/OPD</option>		<option '.($fmSKPD=="02"?"selected":"").' value="02">BIRO/UPTD/B</option>';$ListOPD=				"<select ".$fmSKPD." name='fmSKPD'>".$Ops.		"</select>";		$Ops='<option selected value="01">PIE 3D</option>		<option value="02">BAR</option>';			$Hsl=  "		<input type='hidden' name='doCari' id='doCari' value=''>		<table width=\"100%\" height=\"100%\"  > ";	$Hsl .="<tr align=\"left\" valign=\"middle\">	<td align=\"left\" height='24' width='50'>$ListKIB</td>	<td align=\"left\" width=\"50\">$ListOPD</td>	<td align=\"right\">$datakolom1</td> </tr> ";	$Hsl .="</table>";		return $Hsl;	}function getdatachart1(){global $fmKEPEMILIKAN, $fmSKPD, $fmUNIT, $fmSUBUNIT;global $SKPD,$UNIT,$SUBUNIT;global $fmBIDANG,$fmKELOMPOK,$fmSUBKELOMPOK,$fmSUBSUBKELOMPOK;global $BIDANG_BARANG,$KELOMPOK_BARANG,$SUBKELOMPOK_BARANG,$SUBSUBKELOMPOK_BARANG;  global $kolomdata1,$kolomdata2,$kolomdata3,$kolomdatap1,$kolomdatap2;	global $kolomlabel1,$kolomlabel2,$kolomlabelno;		global $kolomtitle1,$kolomtitle2,$kolomtitle3;		global $ada_data,$JmlTotData,$jmlTotHarga,$jmlTotBarang;		global $cari, $Main, $Pg, $SPg,$COrder,$graph,$doCari;if (empty($fmBIDANG)) $fmBIDANG='00';	if (empty($fmSKPD)) $fmSKPD='00';if ($fmSKPD=='00') {	$Kondisi = ' c!="00" and d="00" and e="00" '; } elseif ($fmSKPD=='01') {	$Kondisi = ' d!="00" and e="00" '; } else if ($fmSKPD=='02') {	$Kondisi = ' d!="00" and e!="00" '; } $sqry="select sum(jml_barang) as jml_barang,sum(jml_harga) as jml_harga from buku_induk  ".($fmBIDANG=='00'?"where a1='11' ":"where a1='11' and f='$fmBIDANG'")." group by a1 order by a1";$QryBarang = mysql_fetch_array(mysql_query($sqry));$jmlTotBarang = $QryBarang['jml_barang'];$jmlTotHarga = $QryBarang['jml_harga'];// $cari->cek .=$sqry.' jml total harga:'.$jmlTotHarga;if ($jmlTotHarga>0) {$ada_data=1;} else {$ada_data=0;}if ($ada_data==1){$sqry = "select * from ref_skpd where $Kondisi order by c,d,e";$qry = mysql_query($sqry);$jmlData= mysql_num_rows($qry);$JmlTotData =$jmlData;$cb=0;$jmlTotHarga=0;$jmlTotBarang = 0;	while($data=mysql_fetch_array($qry)){		array_push($kolomtitle3, $data['c'].".".$data['d'].".".$data['e']);		array_push($kolomtitle1, $data['nm_skpd']);		$cb++;		array_push($kolomlabelno, $cb.'.');						$Kondisi = 'a1="11"';		$Kondisi .= ($fmBIDANG=='00'?'':' and f="'.$fmBIDANG.'"');		$Kondisi .= ($data['c']=='00'?'':' and c="'.$data['c'].'"');		$Kondisi .= ($data['d']=='00'?'':' and d="'.$data['d'].'"');		$Kondisi .= ($data['e']=='00'?'':' and e="'.$data['e'].'"');		$SelectKondisi = "a1,sum(jml_barang) as tot_barang,sum(jml_harga) as tot_harga";		$GroupKondisi="a1";				$jmltharga=0;		$jmltbarang=0;	 	$s1qry = " select $SelectKondisi from buku_induk where $Kondisi ".		" group by $GroupKondisi ";  	 	$qryx = mysql_query($s1qry);		$cc=0;		while($datax=mysql_fetch_array($qryx)){			if ($cc==0) {			$jmltharga=$jmltharga+$datax['tot_harga'];			$jmltbarang=$jmltbarang+$datax['tot_barang'];			}			$cc++;		}//		if (empty($jmltharga) ) $jmltharga=0;//		if (empty($jmltbarang) ) $jmltbarang=0;//		$jmltharga=1000000;		array_push($kolomdata1, $jmltharga);		array_push($kolomdata2, $jmltbarang);		$jmlTotHarga=$jmlTotHarga+$jmltharga;		$jmlTotBarang = $jmlTotBarang+$jmltbarang;		if ($COrder=="Perolehan"){		if ($jmltharga>0) {array_push($kolomlabel2, "%.2f%%");} else {array_push($kolomlabel2, "");}					} else {		if ($jmltbarang>0) {array_push($kolomlabel2, "%.2f%%");} else {array_push($kolomlabel2, "");}					}		//		$cari->cek .=$data['nm_skpd'].' = '.$jmltharga.' '.$s1qry.' - '.$cc.'<br>';			}	 }	}function makepiechart1(){global $kolomdata1,$kolomdata2,$kolomdata3,$kolomdatap1,$kolomdatap2;	global $kolomlabel1,$kolomlabel2,$kolomlabel3;		global $kolomtitle1,$kolomtitle2,$kolomtitle3;global $fmBIDANG;		global $cari,$datawarna;global $ada_data,$COrder;$tmpdir='tmp/';$filename='';$ada_data=1;$filename=$tmpdir.gentmpfile($tmpdir);require_once ('lib/jpgraph/jpgraph.php');require_once ('lib/jpgraph/jpgraph_mgraph.php');require_once ('lib/jpgraph/jpgraph_canvas.php');require_once ('lib/jpgraph/jpgraph_table.php');$mgraph = new MGraph();if ($ada_data==1){	require_once ('lib/jpgraph/jpgraph_pie.php');require_once ('lib/jpgraph/jpgraph_pie3d.php');			$jmldata=count($kolomdata1);			$xrow=$jmldata*25;			$graph = new PieGraph(640,600);			$graph->ClearTheme();			if ($COrder=='Barang'){			$TitleChart='PIE CHART JUMLAH BARANG';			$p1 = new PiePlot3D($kolomdata2);							} else {			$TitleChart='PIE CHART HARGA PEROLEHAN';			$p1 = new PiePlot3D($kolomdata1);							}switch ($fmBIDANG){	case '00':	{		$TitleChart.=" (BUKU INVENTARIS)";		break;	}	case '01':	{		$TitleChart.=" (KIB A TANAH)";		break;	}	case '02':	{		$TitleChart.=" (KIB B PERALATAN DAN MESIN)";		break;	}	case '03':	{		$TitleChart.=" (KIB C GEDUNG DAN BANGUNAN)";		break;	}	case '04':	{		$TitleChart.=" (KIB D JALAN, IRIGASI DAN JARINGAN)";		break;	}	case '08':	{		$TitleChart.=" (KIB E ASET TETAP LAINNYA)";		break;	}	case '09':	{		$TitleChart.=" (KIB F KONTRUKSI DALAM PENGERJAAN)";		break;	}	} 			$graph->SetFrame(false);									$graph->title->Set($TitleChart);			$graph->title->SetFont(FF_ARIAL,FS_BOLD,12);			$p1->SetSliceColors($datawarna);			$p1->SetSize(240);			$p1->SetCenter(0.5,0.5);			$p1->SetAngle(85);			$p1->SetLabels($kolomlabel2);			$p1->SetLabelPos(1.05);			$p1->SetLabelType(PIE_VALUE_PER);				$graph->Add($p1);			$mgraph->add($graph,20,20);		}else{	$cgraph = new CanvasGraph(1000,60);	$t1 = new Text("Tidak ada data !!\nChart tidak dapat dibuat");	$t1->SetPos(0.35,0.10);	$t1->SetOrientation("h");	$t1->SetFont(FF_ARIAL,FS_BOLD,14);	$t1->SetBox("white","black",'gray');	$t1->SetColor("black");	$cgraph->AddText($t1);	$mgraph->add($cgraph,20,20);	}$mgraph->Stroke($filename);// $cari->cek .=' warna : '.$COrder;	return $filename;	}?>